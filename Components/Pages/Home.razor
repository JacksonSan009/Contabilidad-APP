@page "/"
@using System.Globalization
@using System.Text.RegularExpressions
@using System.Diagnostics
@using Contabilidad_APP.Components.Models
@using Contabilidad_APP.Components.Models.Util
@using Contabilidad_APP.Components.Layout

@inject Config Config;


<div class="d-flex align-items-center justify-content-between my-3">
    <h1 class="mb-0">Cuentas del Día</h1>
    <ConfigButton></ConfigButton>
</div>


<div class="container ">

    <p class="fs-6 text-muted my-0">
        Limite de gastos - $ @Config.LimitExpends
    </p>
    <div class="progress">
        <div class="progress-bar" role="progressbar"
             style="width:@progressValue%;"
             aria-valuenow="@progressValue"
             aria-valuemin="0"
             aria-valuemax="100">
            @progressValue%
        </div>
    </div>

</div>

<div class="container">
    <p class="text-center fw-bold fs-2 my-1">
        Gastos diarios
    </p>

    <div class="form-floating ">

        <div class=" my-3 ">
            <InputNumber class="form-control " type="text" id="valueInput" @bind-Value="rawAmount" placeholder="Valor" />
        </div>

        <div class=" my-3 ">
            <InputText class="form-control" type="text" id="spendInput" @bind-Value="description" placeholder="Gasto" />
        </div>
    </div>

    <div class="d-flex justify-content-center my-4">
        <button class="btn btn-primary w-75" @onclick="AddDebit">ADD</button>
    </div>
</div>

<h3 class="text-center">Lista de Débitos:</h3>
@if (debits.Any())
{
    <div class="list-group ">
        @foreach (var Debit in debits)
        {
            <a href="#" class="list-group-item fade show">
                <div>
                    <!-- Amount -->
                    <p class="fw-bold fs-1 my-1">@CurrencyFormatter.FormatToCop(Debit.Amount.ToString())</p>

                    <!-- Description -->
                    <p class="text-muted fs-6 fst-italic my-0">@Debit.Description.ToUpper()</p>
                </div>

                <div class="d-flex flex-column justify-content-end">
                    <p class=" text-end mb-0">@Debit.Date</p>
                </div>
            </a>


        }
    </div>
}

@code {
    private decimal rawAmount { get; set; } = 0;
    private string description { get; set; } = "";
    private decimal progressValue { get; set; } = 0;
    
    private List<Debit> debits { get; set; } = new List<Debit>();

    private void AddDebit()
    {
        if (rawAmount != 0 || description != "")
        {
            debits.Add(new Debit(rawAmount, DateTime.Now, description));
        }

        cleanForm();

        this.progressValue = (calculateExpends() / Config.LimitExpends) * 100;
    }

    private decimal calculateExpends()
    {
        return debits.Sum(x => x.Amount);
    }

    private void cleanForm()
    {
        rawAmount = 0;
        description = "";
    }
}
